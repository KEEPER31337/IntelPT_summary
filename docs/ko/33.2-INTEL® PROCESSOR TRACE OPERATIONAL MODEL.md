# 33.2 INTEL® PROCESSOR TRACE OPERATIONAL MODEL

## 33.2.1 Change of Flow Instruction (COFI) Tracing

### 33.2.1.1 Direct Transfer COFI

### 33.2.1.2 Indirect Transfer COFI

### 33.2.1.3 Far Transfer COFI

## 33.2.2 Software Trace Instrumentation with PTWRITE

## 33.2.3 Power Event Tracing

## 33.2.4 Event Tracing

## 33.2.5 Trace Filtering

### 33.2.5.1 Filtering by Current Privilege Level (CPL)

### 33.2.5.2 Filtering by CR3

### 33.2.5.3 Filtering by IP

#### TraceStop

#### IP Filtering Example

#### IP Filtering and TraceStop

## 33.2.6 Packet Generation Enable Controls

### 33.2.6.1 Packet Enable (PacketEn)

### 33.2.6.2 Trigger Enable (TriggerEn)

### 33.2.6.3 Context Enable (ContextEn)

### 33.2.6.4 Branch Enable (BranchEn)

### 33.2.6.5 Filter Enable (FilterEn)

## 33.2.7 Trace Output

### 33.2.7.1 Single Range Output

#### Single-Range Output Errors

### 33.2.7.2 Table of Physical Addresses (ToPA)

#### Single Output Region ToPA Implementation

#### ToPA Table Entry Format

#### ToPA STOP

#### ToPA PMI

#### PMI Preservation

#### ToPA PMI and Single Output Region ToPA Implementation

#### ToPA PMI and XSAVES/XRSTORS State Handling

#### ToPA Errors

### 33.2.7.3 Trace Transport Subsystem

### 33.2.7.4 Restricted Memory Access

#### Modifications to Restricted Memory Regions

## 33.2.8 Enabling and Configuration MSRs

### 33.2.8.1 General Considerations

### 33.2.8.2 IA32_RTIT_CTL MSR

### 33.2.8.3 Enabling and Disabling Packet Generation with TraceEn

#### Disabling Packet Generation

#### Other Writes to IA32_RTIT_CTL

### 33.2.8.4 IA32_RTIT_STATUS MSR

### 33.2.8.5 IA32_RTIT_ADDRn_A and IA32_RTIT_ADDRn_B MSRs

### 33.2.8.6 IA32_RTIT_CR3_MATCH MSR

### 33.2.8.7 IA32_RTIT_OUTPUT_BASE MSR

### 33.2.8.8 IA32_RTIT_OUTPUT_MASK_PTRS MSR

## 33.2.9 Interaction of Intel® Processor Trace and Other Processor Features

### 33.2.9.1 Intel® Transactional Synchronization Extensions (Intel® TSX)

### 33.2.9.2 TSX and IP Filtering

### 33.2.9.3 System Management Mode (SMM)

### 33.2.9.4 Virtual-Machine Extensions (VMX)

### 33.2.9.5 Intel® Software Guard Extensions (Intel® SGX)

#### Debug Enclaves

### 33.2.9.6 SENTER/ENTERACCS and ACM

### 33.2.9.7 Intel® Memory Protection Extensions (Intel® MPX)

